<!DOCTYPE html>
<head>	
	<script type="text/javascript" src="crafty.js"></script>
</head>
<body>
	<script type="text/javascript">
		Crafty.init(700, 890);
        
        var color = 'rgb(255,0,0)';
        var p = 0;
        
        
        //turn the sprite map into usable components
        Crafty.sprite(20, "cat.png", {
            cat: [0, 0]
        });
        Crafty.sprite(20, "sprites_1.png", {
            brick: [0, 0],
            window:[0, 1],
            roof1:[0,2,2,1],
            roof2:[0,3,2,1],
            roof3:[0,4],
            door:[0,5,1,2],
        });
        
        
        Crafty.scene("loading", function () {
            //load takes an array of assets and a callback when complete
            Crafty.load(["cat.png", "bg.png"], function () {
                Crafty.scene("main"); //when everything is loaded, run the main scene
            });
        
            //black background with some loading text
            //Crafty.background("#000");
            Crafty.e("2D, DOM, Text").attr({ w: 100, h: 20, x: 150, y: 120 })
                .text("Loading")
                .css({ "text-align": "center" });
        });
        
        //automatically play the loading scene
        Crafty.scene("loading");

        Crafty.scene("main", function () {
            Crafty.background( Crafty.e("2D, DOM, Image").image("bg.png"));
            
                
                

            //Message - currently just for debugging
            Crafty.e("Message, DOM, 2D, Text")
                .attr({ x: 515, y: 20, w: 100, h: 20, points: 0 })
                .text("Welcome " + p)
            
            //pallet items
            Crafty.e('Media_0, 2D, DOM, brick, Mouse')
                .attr({ x: 500, y: 840, w: 20, h: 20})
                       
                .bind("Click", function () {
                    Crafty("Message").each(function () { 
                        this.text("You clicked")});
                    Crafty("Brush").each(function () { 
                        this.media = 0; 
                    })
                })
                
            Crafty.e('Media_1, 2D, DOM, window, Mouse')
                
                .attr({ x: 525, y: 840, w: 20, h: 20})
                       
                .bind("Click", function () {
                    Crafty("Message").each(function () { 
                        this.text("You clicked")});
                    Crafty("Brush").each(function () { 
                        this.media = 1; 
                    })
                })

             Crafty.e("Media_2, 2D, DOM, cat, , Mouse")
                .attr({x: 545, y: 840 })
                       
                .bind("Click", function () {
                    Crafty("Message").each(function () { 
                        this.text("You clicked")});
                    Crafty("Brush").each(function () { 
                        this.media = 2; 
                    })
                })
            Crafty.e('Media_3, 2D, DOM, roof1, Mouse')
                
                .attr({ x: 565, y: 840})
                       
                .bind("Click", function () {
                    Crafty("Message").each(function () { 
                        this.text("You clicked")});
                    Crafty("Brush").each(function () { 
                        this.media = 3; 
                    })
                })

             Crafty.e("Media_4, 2D, DOM, roof3, Mouse")
                .attr({x: 610, y: 840 })
                       
                .bind("Click", function () {
                    Crafty("Message").each(function () { 
                        this.text("You clicked")});
                    Crafty("Brush").each(function () { 
                        this.media = 4; 
                    })
                })

             Crafty.e("Media_5, 2D, DOM, roof2,  Mouse")
                .attr({x:635, y: 840 })
                       
                .bind("Click", function () {
                    Crafty("Message").each(function () { 
                        this.text("You clicked")});
                    Crafty("Brush").each(function () { 
                        this.media = 5; 
                    })
                })
                
             Crafty.e("Media_5, 2D, DOM, door,  Mouse")
                .attr({x:680, y: 820 })
                       
                .bind("Click", function () {
                    Crafty("Message").each(function () { 
                        this.text("You clicked")});
                    Crafty("Brush").each(function () { 
                        this.media = 6; 
                    })
                })

                
            //Floor            
            Crafty.e("Floor, 2D, DOM, Color, Solid")
                .attr({x: 0, y: 800, w: 700, h: 20 })
                .color("green")    

            //Brush
            Crafty.e("Brush, 2D, DOM, Color, Multiway")
                .color(color)
                .attr({ x: 200, y: 200, w: 20, h: 20, media: 0 })
                //.multiway(10, { UP_ARROW: -90, DOWN_ARROW: 90, LEFT_ARROW: 180, RIGHT_ARROW: 0 })
                
                .bind('EnterFrame', function () {
                   // hit floor or roof
                    if (this.y <= 20 )
                        this.y = 20;
                    if (this.y >= 860 )
                        this.y = 860;
                })                     

                .bind("KeyDown", function (e) {
                    
                    Crafty("Message").each(function () { 
                        this.text("You keyed " + ++p )});
                    if (e.key == Crafty.keys['ENTER'] || e.key == Crafty.keys['SPACE']){    
                        if (this.media == 0){ 
                            Crafty.e('2D, DOM, brick, Collision, Gravity, Solid')
                                //.color("blue")
                                .attr({
                                w: 20,
                                h: 20,
                                x: this.x,
                                y: this.y
                                })
                                .gravity("Solid")
                        } else if (this.media == 1){
                            Crafty.e('2D, DOM,  window, SpriteAnimation, Collision, Gravity, Solid')
                                
                                .attr({
                                    w: 20,
                                    h: 20,
                                    x: this.x,
                                    y: this.y
                                })
                                .collision()
                                .animate('window', 0, 1, 1)
                                .bind("EnterFrame", function () {
                                    if(!this.isPlaying())
                                        this.animate('window', 800);
                                })
                                .gravity("Solid")
                        } else if(this.media == 2){
                            Crafty.e("2D, DOM, cat, SpriteAnimation, Gravity")
                                .attr({
                                x: this.x,
                                y: this.y
                                })
                                .animate('cat', 0, 0, 2)
                                .bind("EnterFrame", function () {
                                    if(!this.isPlaying())
                                        this.animate('cat', 80);
                                })
                                .gravity("Solid")
                        } else if(this.media == 3){
                            Crafty.e("2D, DOM, roof1, Gravity, Solid")
                                .attr({
                                x: this.x,
                                y: this.y
                                })
                                .gravity("Solid")
                             
                        } else if(this.media == 4){
                            Crafty.e("2D, DOM, roof3, Gravity, Solid")
                                .attr({
                                x: this.x,
                                y: this.y
                                })
                                .gravity("Solid")
                                                         
                        } else if(this.media == 5){
                            Crafty.e("2D, DOM, roof2, Gravity, Solid")
                                .attr({
                                x: this.x,
                                y: this.y
                                })
                                .gravity("Solid")
                        }else if(this.media == 6){
                            Crafty.e("2D, DOM, door, Gravity, Solid")
                                .attr({
                                x: this.x,
                                y: this.y
                                })
                                .gravity("Solid")
                        }
                             
                    } else if (e.key == Crafty.keys['UP_ARROW'] || e.key == Crafty.keys['W']){
                            this.y = this.y - 20;
                    }else if (e.key == Crafty.keys['DOWN_ARROW'] || e.key == Crafty.keys['S']){
                            this.y = this.y + 20;
                    }else if (e.key == Crafty.keys['LEFT_ARROW'] || e.key == Crafty.keys['A']){
                            this.x = this.x - 20;
                    }else if (e.key == Crafty.keys['RIGHT_ARROW'] || e.key == Crafty.keys['D']){
                            this.x = this.x + 20;
                    }
                })


        })

        
        //Crafty.addEntityFactory('Wall', function() {
        //      var entity = Crafty.e('2D, DOM, Color, Collision')
         //     .color("blue")
         //     .attr({
          //      w: 20,
            //    h: 20,
              //  x: Crafty("Brush").x,
               // y: Crafty("Brush").y
              //})
              //.addComponent('Gravity').gravity("Floor");

              //return entity;
            //})
    
	</script>
</body>
</html>