<!DOCTYPE html>
<head>	
	<script type="text/javascript" src="crafty.js"></script>
    <link rel="stylesheet" type="text/css" href="site.css" />
    <link rel="stylesheet" type="text/css" href="960/reset.css" />
    <link rel="stylesheet" type="text/css" href="960/text.css" />
    <link rel="stylesheet" type="text/css" href="960/960.css" />
</head>
<body>
 <div id="Everything_Box" class="container_12">
    <div " class="grid_12">
       <p id="logo">Ava-chat<p>
      
    </div>
    <div id="main_game_div" class="grid_12" style="text-align: center;">
    
        <div id="cr-stage">
<script type="text/javascript">
            var  unreadPost = true;
            var  npc_post = true;
            var width = 940;
            Crafty.init(width, 780);
            
            var color = 'rgb(255,0,0)';
            var p =0;
            var d=0;
            var a = 0;
            var pt = 0;
            var ju = 0;

            var op1 ="";
            var op2 ="";
            var op3 ="";            
            var choice_up = false;
            var question_posed_by = 0;
            
            var a_level =0;
            var d_level=0;
            var pt_level =0;
            var ju_level=0;
            var media = 7;
            var over =false;
            var random_post = false;
            
            //turn the sprite maps into usable components
            Crafty.sprite(20, "cat.png", {
                cat: [0, 0],
                rev_cat:[0,1]
            });
            Crafty.sprite(900, "pitys_scan_colored2.png", {
                pitys_scan: [0, 0],
            });
            Crafty.sprite(900, "dolly_scan.png", {
                dolly_scan: [0, 0],
            });
            Crafty.sprite(900, "judy_scan.png", {
                judy_scan: [0, 0],
            });
            Crafty.sprite(900, "anna_scan_colored.png", {
                anna_scan: [0, 0],
            });
            Crafty.sprite(20, "sprites_1.png", {
                inbrick: [0, 0],
                brick: [1, 0],
                window:[0, 1],
                roof1:[0,2,2,1],
                roof2:[0,3,2,1],
                roof3:[0,4],
                door:[0,5,1,2],
                indoor:[1,5,1,2],
            });
            Crafty.sprite(20, "sprites_2.png", {
                flower: [0, 0],
                b_fence:[0, 1],
                w_fence:[1,1],
                b_roof1:[0,2,2,1],
                b_roof2:[0,3,2,1],
                b_roof3:[0,4],
                tree1:[0,5,1,2],
                tree2:[1,5,1,2],
            });
            Crafty.sprite(20, "examplenpc.png", {
                npc: [0, 0,1,2],
                rev_npc: [0,2,1,2]
            });
            
            Crafty.sprite(20, "examplenpc2.png", {
                pitys: [0,2,1,2],
                judy: [0,0,1,2]
            });
            Crafty.sprite(100, "speak4.png", {
                dolly_post: [0, 2,6,1],
                pitys_post: [0, 3,6,1],
                judy_post: [0, 4,6,1],
                anna_post: [0, 5,6,1],            
            });  
            Crafty.sprite(100, "speak_ends.png", {
                dolly_end: [0, 0,6,3],
                pitys_end: [0, 3,6,3],
                judy_end: [0, 6,6,3],
                anna_end: [0, 9,6,4],            
            });  
            Crafty.sprite(100, "choice_bubble.png", {
                choice_bubble: [0, 0,1,2],
            });            
            Crafty.sprite(100, "speak2.png", {
                greenpost: [0, 1],
                bluepost:[0,0,6,1]
            });
            
            Crafty.scene("loading", function () {
                //load takes an array of assets and a callback when complete
                Crafty.load(["cat.png", "bg4.png", "sprites_1.png", "examplenpc.png", "speak4.png"], function () {
                    Crafty.scene("main"); //when everything is loaded, run the main scene
                });
            
                //black background with some loading text
                //Crafty.background("#000");
                Crafty.e("2D, DOM, Text").attr({ w: 100, h: 20, x: 150, y: 120 })
                    .text("Loading")
                    .css({ "text-align": "center" });
            });
            
            //automatically play the loading scene
            Crafty.scene("loading");

            Crafty.scene("main", function () {
                Crafty.background( Crafty.e("2D, DOM, Image").image("bg4.png"));
                
         
            Crafty.e("Option_1, DOM, 2D, Text, Mouse, option, SpriteAnimation")
                    .attr({ x: 150, y: 150, w:200, h:300, z:10000, visible:false})
                    .text(op1)
                    .bind("EnterFrame", function () {
                        
                        if (choice_up){
                            this.visible = true;
                            this.text(op1)
                            this.addComponent("choice_bubble");  
                            this.w = 200;
                            this.h = 300;
                        }
                    })
                                               
                    .bind("Click", function () {
                       if(choice_up){                      
                           if ( question_posed_by == 3){
                                ju += 5;
                                ju_level += 1;
                           }else if(question_posed_by == 1){
                                d += 10;
                                d_level += 1;
                           }else if(question_posed_by == 2){
                                pt -= 5;
                                pt_level += 1;
                           }else if(question_posed_by == 0){
                                a += 5;
                                a_level += 1;
                           }
                           op1 = "";
                           choice_up = false;
                           Crafty("option").each( function () {                     
                                this.visible=false;
                           })
                       }
                    })
            
            Crafty.e("Option_2, DOM, 2D, Text, Mouse, option, SpriteAnimation")
                    .attr({ x: 355, y: 150 , w:200, h:300, z:10000, visible:false})
                    .text(op2)
                    .bind("EnterFrame", function () {
                        
                        if (choice_up){
                            this.visible = true;
                            this.text(op2);
                            this.addComponent("choice_bubble");
                            this.w = 200;
                            this.h = 300;
                        }
                    })
                    
                                               
                    .bind("Click", function () {
                       if(choice_up){                       
                           if ( question_posed_by == 3){
                                ju += 10;
                                ju_level += 1;
                           }else if(question_posed_by == 1){
                                d -= 5;
                                d_level += 1;
                           }else if(question_posed_by == 2){
                                pt += 5;
                                pt_level += 1;
                           }else if(question_posed_by == 0){
                                a += 10;
                                a_level += 1;
                           }
                           op2 = "";
                           choice_up = false;
                           Crafty("option").each( function () {this.visible=false;}) 
                       }
                    })       
                    
            Crafty.e("Option_3, DOM, 2D, Text, Mouse,option, SpriteAnimation")
                    .attr({ x: 560, y: 150 ,  w:200, h:300, z:10000, visible:false})
                    .text(op3)
                    .bind("EnterFrame", function () {
                        
                        if (choice_up){
                            this.visible = true;
                            this.text(op3);
                            this.addComponent("choice_bubble");
                            this.w = 200;
                            this.h = 300;
                            }

                    })
                                               
                    .bind("Click", function () {
                       if(choice_up){
                           if ( question_posed_by == 3){
                                ju -= 5;
                                ju_level += 1;
                           }else if(question_posed_by == 1){
                                d += 5;
                                d_level += 1;
                           }else if(question_posed_by == 2){
                                pt += 10;
                                pt_level += 1;
                           }else if(question_posed_by == 0){
                                a -= 5;
                                a_level += 1;
                           }
                           op3 = "";
                           choice_up = false;
                           Crafty("option").each( function () {this.visible=false;})
                       }
                    })         
         


         
                //Player Post
                Crafty.e("Post, DOM, 2D,  Text, Delay , greenpost")
                    .attr({ x: 160, y: 320 ,w:600, h: 100, z:10000, visible:false})
                    .text("")
                    
                    .bind("EnterFrame", function () {
                        
                        if (unreadPost){
                            this.y = 320;
                            this.visible = true;
                            this.text(document.getElementById('PostBox').value);
                            this.textFont({ family: 'Arial', size:"40px" , weight: "bold"})
                            this.delay(function(){npc_post = true;},1500);
                            this.delay(function(){this.visible = false},3000);
                           unreadPost = false;
                           
                       }
                    })
                    
                   
 
                    
                //NPC Post
                Crafty.e("Post, DOM, 2D,  Text, Delay , bluepost")
                    .attr({ x: 160, y: 320 ,w:600, h: 100,  z:10000, visible:false, speaker:"0"})
                    .text("")
                    
                    .bind("EnterFrame", function () {
   
                        pst = document.getElementById('PostBox').value.toUpperCase();
                     /*   if (pst.indexOf("HTTP:") > -1){
                            var xhr = new XMLHttpRequest();
                            xhr.open('GET', pst, true);
                            xhr.onreadystatechange = function() {
                              if (xhr.readyState === 4)  { 
                                pst = xhr.responseText;
                              }
                            };
                            xhr.close;
                        }*/
                        
                           if (!over){                        
                               //story
                               if( d > 1 && d/25 >= 1 && d_level ==0){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                     
                                     this.speaker = "1";
                                     this.text("What do you think I got my handle from?")
                                     question_posed_by = "1";  
                                     op1 = "Um, a sheep?"
                                     op2 = "A baby doll!"
                                     op3 = "Random?"
                                     choice_up = true;
                               }else if( d/25 >=2 && d_level ==1){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                    
                                     this.speaker = "1";
                                     this.text("How long do you think it takes to get to my farm?")
                                     question_posed_by = "1";  
                                     op1 = "Eight days?"
                                     op2 = "What are you a stalker?"
                                     op3 = "Um, a few hours?"
                                     choice_up = true;
                               }else if( d/25 >=3 && d_level ==2){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                    
                                     this.speaker = "1";
                                     this.text("We're becoming good friends aren't we?")
                                     question_posed_by = "1";  
                                     op1 = "I wish I could clone you and keep you here!"
                                     op2 = "I guess"
                                     op3 = "Sure are!"
                                     choice_up = true; 
                               }else if( d/25 >=4 && d_level ==3){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){
                                        this.x =0;
                                        this.y =0;
                                        this.h = 900;
                                        this.w = 900;
                                        this.z = 100000000;
                                        this.addComponent("dolly_scan") },7000);
                                     this.speaker = "1";
                                     this.text("");
                                     this.addComponent("dolly_end");
                                     over =true;
                               }else if ( pt > 1 && pt/25 >= 1 && pt_level ==0){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                     
                                     this.speaker = "2";
                                     this.text("What's your favorite tree?")
                                     question_posed_by = "2";  
                                     op1 = "What?"
                                     op2 = "Maple"
                                     op3 = "Oak"   
                                     choice_up = true;
                               }else if ( pt/25 >=2 && pt_level ==1){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                     this.speaker = "2";
                                     this.text("What kind of pet should I get?")
                                     question_posed_by = "2";  
                                     op1 = "Fish. Easy to care for."
                                     op2 = "Dog, obviously."
                                     op3 = "Maybe a bird?"  
                                    choice_up = true;   
                               }else if ( pt/25 >=3 && pt_level ==2){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                     this.speaker = "2";
                                     this.text("I feel like we really get each other")
                                     question_posed_by = "2";  
                                     op1 = "We do?"
                                     op2 = "yea"
                                     op3 = "We're like branches on the same tree."  
                                    choice_up = true; 
                                }else if ( pt/25 >=4 && pt_level ==3){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){
                                        this.x =0;
                                        this.y =0;
                                        this.h = 900;
                                        this.w = 900;
                                        this.z = 100000000;
                                        this.addComponent("pitys_scan") },7000);
                                     this.speaker = "2";
                                     this.text("");
                                     this.addComponent("pitys_end"); 
                                     over =true;                             
                               }else if ( ju > 1 && ju/25 >= 1 && ju_level ==0){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                     this.speaker = "3";                             
                                     this.text("What's your favorite dish?")
                                     question_posed_by = "3";  
                                     op1 = "Soup"
                                     op2 = "Pot Pie"
                                     op3 = "Sushi"
                                     choice_up = true;
                               }else if ( ju/25 >=2 && ju_level ==1){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                    this.speaker = "3";
                                    this.text("I added a new dish to my restuarant's menu!")
                                    question_posed_by = "3";  
                                    op1 = "Oh cool"
                                    op2 = "Wish I could try it."
                                    op3 = "Oh, I forgot lunch! bbl"
                                    choice_up = true;
                               }else if ( ju/25 >=3 && ju_level ==2){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                    this.speaker = "3";
                                    this.text("You should come visit my restuarant sometime.")
                                    question_posed_by = "3";  
                                    op1 = "oh, whenever I'm on a trip"
                                    op2 = "I will! I've been planning to move near there."
                                    op3 = "Oh, I forgot lunch again!"
                                    choice_up = true;
                               }else if ( ju/25 >=4 && ju_level ==3){
                                     this.y = 10;
                                     this.visible = true;
                                   this.delay(function(){
                                        this.x =0;
                                        this.y =0;
                                        this.h = 900;
                                        this.w = 900;
                                        this.z = 100000000;
                                        this.addComponent("judy_scan") },7000);
                                    this.speaker = "3";
                                    this.text("");
                                    this.addComponent("judy_end");
                                    over =true;
                               }else if ( a >= 1 && a/25 >= 1 && a_level ==0){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                    this.speaker = "0";
                                    this.text("You have made several interesting posts.")
                                    question_posed_by = "0";  
                                    op1 = "They programed you to find things interesting?"
                                    op2 = "Glad you think so."
                                    op3 = "Thanks, bot"
                                    choice_up = true;
                               }else if ( a >=1 && a/25 >=2 && a_level ==1){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                    this.speaker = "0";
                                    this.text("You have made several interesting posts.")
                                    question_posed_by = "0";  
                                    op1 = "k"
                                    op2 = "That's cause you are my buddy Anna!"
                                    op3 = "Thanks ... again, bot"
                                    choice_up = true;
                               }else if ( a >=1 && a/25 >=3 && a_level ==2){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){this.visible = false},3000);
                                    this.speaker = "0";
                                    this.text("You have made several interesting posts.")
                                    question_posed_by = "0";  
                                    op1 = ">.>"
                                    op2 = "Anna, I like making you happy."
                                    op3 = "<.<"
                                    choice_up = true;
                               }else if ( a >=1 && a/25 >=4 && a_level ==3){
                                     this.y = 10;
                                     this.visible = true;
                                     this.delay(function(){
                                        this.x =0;
                                        this.y =0;
                                        this.h = 900;
                                        this.w = 900;
                                        this.z = 100000000;
                                        this.addComponent("anna_scan") },7000);
                                    this.speaker = "0";
                                    this.text("");
                                    this.addComponent("anna_end");
                                    over =true;
                               }else{
                               
                                    
                                    if (npc_post){
                                        Crafty("Post").each( function () {this.y -= 150;})
                                        this.y = 320;
                                        this.visible = true;
                                        if (pst.indexOf("HELLO") >= 0){
                                            this.text("Hello");
                                            this.speaker=0;
                                        }else if (pst.indexOf("SHEEP") >= 0 || (pst.indexOf("FARM") >= 0) || (pst.indexOf("CLONE") >= 0) || (pst.indexOf("CAT")) >= 0 || (pst.indexOf("BOT") >= 0) || (pst.indexOf("TREE")) >=0|| (pst.indexOf("BRANCH")) >=0 || (pst.indexOf("FOOD")) >=0 || (pst.indexOf("FORK")) >=0 || (pst.indexOf("RESTAURANT")) >=0){
                                            var i = 0;
                                            var j = pst.indexOf("SHEEP", i);
                                            while (j > -1){
                                               d += 1; 
                                               i = j +1
                                               j = pst.indexOf("SHEEP", i);
                                               this.speaker = "1";
                                               this.text(":)");
                                            }
                                            i = 0;
                                            j = pst.indexOf("FARM", i);
                                            while(j > -1){
                                                d += 1; 
                                                i = j +1
                                                j = pst.indexOf("FARM", i);
                                                this.speaker = "1";
                                                this.text(":)");
                                            }
                                            i = 0;
                                            j=pst.indexOf("CLONE", i);
                                            while(j > -1){  
                                               d += 1; 
                                               i = j+1
                                               j = pst.indexOf("CLONE", i);
                                               this.speaker = "1";
                                               this.text(":)");
                                            }
                                            var i = 0;
                                            var j = pst.indexOf("CAT", i);
                                            while (j > -1){
                                               a += 2; 
                                               i = j +1
                                               j = pst.indexOf("CAT", i);
                                               this.text("~Meow");
                                               this.speaker = "0";  
                                            }
                                            i = 0;
                                            j = pst.indexOf("BOT", i);
                                            while(j > -1){  
                                               a -= 1; 
                                               i = j+1
                                               j = pst.indexOf("BOT ", i);
                                               this.text("...")
                                               this.speaker = "0";  
                                            } 
                                            var i = 0;
                                            var j = pst.indexOf("BRANCH", i);
                                            while (j > -1){
                                               pt += 1; 
                                               i = j +1
                                               j = pst.indexOf("BRANCH", i);
                                               this.text("ah, interesting");
                                               this.speaker = "2";  
                                            }
                                            i = 0;
                                            j = pst.indexOf("TREE", i);
                                            while(j > -1){  
                                               pt += 1; 
                                               i = j+1
                                               j = pst.indexOf("TREE ", i);
                                               this.text("ah, nature")
                                               this.speaker = "2";  
                                            }                            i = 0;
                                            j = pst.indexOf("FOOD", i);
                                            while(j > -1){  
                                               ju += 1; 
                                               i = j+1
                                               j = pst.indexOf("FOOD ", i);
                                               this.text("All this talk of food makes me hungry!")
                                               this.speaker = "3";  
                                            } 
                                            var i = 0;
                                            var j = pst.indexOf("FORK", i);
                                            while (j > -1){
                                               ju += 1; 
                                               i = j +1
                                               j = pst.indexOf("FORK", i);
                                               this.text("Utensils?");
                                               this.speaker = "3";  
                                            }
                                            i = 0;
                                            j = pst.indexOf("RESTAURANT", i);
                                            while(j > -1){  
                                               ju += 1; 
                                               i = j+1
                                               j = pst.indexOf("RESTAURANT ", i);
                                               this.text("I own a restuarant, ya know?")
                                               this.speaker = "3";  
                                            }
                                            
                                            
                                            
                   
                                        }else{
                                             this.speaker = Crafty.math.randomInt(1, 3);
                                             this.text("hmmm");
                                        }
                                                              
                                            
                                        this.textFont({ family: 'Arial', size:"40px" , weight: "bold"})
                                        this.delay(function(){ this.visible = false;},3000);
                                        npc_post = false;
                                   }else if (!random_post){
                                            
                                          if( Crafty.math.randomInt(1, 300) == 300){
                                            random_post = true;
                                            this.visible =true;
                                            this.y = 320;
                                            this.delay(function(){npc_post = false; this.visible = false; random_post = false;},3000);
                                            var o = Crafty.math.randomInt(0, 3);
                                            if (o == 0){
                                                this.speaker = "0"; 
                                               this.text("=^.^=")
                                                
                                            }else if (o == 1){
                                                this.speaker = "1";
                                                this.text("Baaa :P")
                                                   
                                            }else if (o==2){
                                                this.speaker = "2";  
                                                this.text("I wish my apartment had a yard with a tree.")
                                                 
                                            }else if (o==3){
                                                this.speaker = "3";
                                                this.text("Oh there's a great show on Food Network right now!")
                                                   
                                            }
                                          }
                                   }

                            } 
                                if (!over){
                                   if (this.speaker == 0)
                                            this.addComponent("anna_post");
                                    else if(this.speaker == 1)
                                            this.addComponent("dolly_post");
                                    else if(this.speaker == 2)
                                            this.addComponent("pitys_post");
                                    else if(this.speaker == 3)
                                            this.addComponent("judy_post");      
                                }
                        }
                    })
                    
               //pallet selection
               Crafty.e('Selection, 2D, DOM, Color')
                .attr({ x: 60, y: 620, w: 24, h: 24}) 
                .color(color)
                
                .bind("EnterFrame", function () {
       
                    if(media == 0){
                        
                        this.x = 58;
                        this.y=608;
                        this.w = 24;
                        this.h = 24;
                    }else if(media ==1){
                        this.x = 88;
                        this.y=608;
                        this.w = 24;
                        this.h = 24;
                    }else if(media ==2){
                        this.x = 828;
                        this.y=608;
                        this.w = 24;
                        this.h = 24;                    
                    }else if(media ==3){
                        this.x = 128;
                        this.y=608;
                        this.w = 44;
                        this.h = 24;                    
                    }else if(media ==4){
                        this.x = 179;
                        this.y=608;
                        this.w = 24;
                        this.h = 24;                    
                    }else if(media ==5){
                        this.x = 208;
                        this.y=608;
                        this.w = 44;
                        this.h = 24;                        
                    }else if(media ==6){
                        this.x = 453;
                        this.y=608;
                        this.w = 24;
                        this.h = 44;                        
                    }else if(media ==7){
                        this.x = 28;
                        this.y=608;
                        this.w = 24;
                        this.h = 24;                        
                    }else if(media ==8){
                        this.x = 428;
                        this.y=608;
                        this.w = 24;
                        this.h = 44;                        
                    }else if(media ==9){
                        this.x = 478;
                        this.y=608;
                        this.w = 24;
                        this.h = 44;                        
                    }else if(media ==10){
                        this.x = 503;
                        this.y=608;
                        this.w = 24;
                        this.h = 44;                        
                    }else if(media ==11){
                        this.x = 128;
                        this.y = 638;
                        this.w = 44;
                        this.h = 24;                    
                    }else if(media ==12){
                        this.x = 179;
                        this.y=638;
                        this.w = 24;
                        this.h = 24;                    
                    }else if(media ==13){
                        this.x = 208;
                        this.y=638;
                        this.w = 44;
                        this.h = 24;                        
                    }else if(media ==14){
                        this.x = 28;
                        this.y=638;
                        this.w = 24;
                        this.h = 24;                        
                    }else if(media == 15){
                        
                        this.x = 58;
                        this.y=638;
                        this.w = 24;
                        this.h = 24;
                    }else if(media ==16){
                        this.x = 88;
                        this.y=638;
                        this.w = 24;
                        this.h = 24;
                    }
                })
                //pallet items
                Crafty.e('Media_0, 2D, DOM, brick, Mouse, Pallet_item')
                    .attr({ x: 60, y: 610, w: 20, h: 20})       
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 0; 
                        })
                    })
                    
                Crafty.e('Media_1, 2D, DOM, window, Mouse')
                    
                    .attr({ x: 90, y: 610, w: 20, h: 20})
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 1; 
                        })
                    })

                 Crafty.e("Media_2, 2D, DOM, cat, , Mouse")
                    .attr({x: 830, y: 610 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 2; 
                        })
                    })
                Crafty.e('Media_3, 2D, DOM, roof1, Mouse')
                    
                    .attr({ x: 130, y: 610})
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 3; 
                        })
                    })

                 Crafty.e("Media_4, 2D, DOM, roof3, Mouse")
                    .attr({x: 180, y: 610 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 4; 
                        })
                    })

                 Crafty.e("Media_5, 2D, DOM, roof2,  Mouse")
                    .attr({x:210, y: 610 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 5; 
                        })
                    })
                    
                 Crafty.e("Media_6, 2D, DOM, door,  Mouse")
                    .attr({x:455, y: 610 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 6; 
                        })
                    })

                    Crafty.e("Media_7, 2D, DOM, inbrick,  Mouse")
                    .attr({x:30, y: 610 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 7; 
                        })
                    })
                    
                 Crafty.e("Media_8, 2D, DOM, indoor,  Mouse")
                    .attr({x:430, y: 610 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 8; 
                        })
                    })
                    
                    Crafty.e("Media_8, 2D, DOM, tree1,  Mouse")
                    .attr({x:480, y: 610 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 9; 
                        })
                    })
                    Crafty.e("Media_8, 2D, DOM, tree2,  Mouse")
                    .attr({x:505, y: 610 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 10; 
                        })
                    })
                Crafty.e('Media_3, 2D, DOM, b_roof1, Mouse')
                    
                    .attr({ x: 130, y: 640})
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 11; 
                        })
                    })

                 Crafty.e("Media_4, 2D, DOM, b_roof3, Mouse")
                    .attr({x: 180, y: 640 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 12; 
                        })
                    })

                 Crafty.e("Media_5, 2D, DOM, b_roof2,  Mouse")
                    .attr({x:210, y: 640 })
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 13; 
                        })
                    })                    
                    
                 Crafty.e('Media_0, 2D, DOM, b_fence, Mouse')
                    .attr({ x: 30, y: 640, w: 20, h: 20})       
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 14; 
                        })
                    })
                    
                 Crafty.e('Media_0, 2D, DOM, w_fence, Mouse')
                    .attr({ x: 60, y: 640, w: 20, h: 20})       
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 15; 
                        })
                    }) 
                    
                Crafty.e('Media_1, 2D, DOM, flower, Mouse')
                    
                    .attr({ x: 90, y: 640, w: 20, h: 20})
                           
                    .bind("Click", function () {
                         
                        Crafty("Brush").each(function () { 
                            media = 16; 
                        })
                    })
                    
                    
                    //Crafty.e("Save_Test, 2D, DOM, rev_cat,  Mouse")
                    //.attr({x:30, y: 620 })
                           
                    //.bind("Click", function () {
                       // var ent = Crafty.e("2D, DOM, Color")
                       //     .attr({x: 20, y: 20, w: 100, h:100})
                       //     .color(color);
                      //  Crafty.storage.open('MyGame');
                      //  Crafty.storage.save('MyEntity', 'save', ent);
                    //})
                    
                    
                //Mover
                Crafty.c("Mover" ,{
                    init: function(){
                        this.requires('SpriteAnimation');
                    },

                    
                        walk: function(){
                            //if(!this.isPlaying())
                            if( Crafty.math.randomInt(0, 5) < this.speed){
                                if(this.dX == 1 ){
                                    this.animate('right', 3);
                                }else{
                                    this.animate('left', 3);
                                }
                                if(this.x > (width-20) || this.x < 9){
                                    this.turnAround();
                                }
                                else{
                                     if( Crafty.math.randomInt(0, 100) < this.turnFactor){
                                        this.turnAround();
                                     }else{
                                        this.x = this.x + this.dX;
                                    }
                                }
                            }
                        },
                        
                    turnAround: function(){
                            this.dX *= -1;
                            this.x = this.x + this.dX;
                    }
                
                });
                
                //Floor            
                Crafty.e("Floor, 2D, DOM, Color, Solid, SuperSolid")
                    .attr({x: 10, y: 570, w: width-19, h: 20 })
                    .color("green")

                //NPCs
                    //Dolly
                Crafty.e("NPC, 2D, DOM, npc, Collision, Mover")
                    .attr({x: 15, y: 530, z:100, dX:1, speed:2, turnFactor:5})
                    .animate('right', 0, 0, 3)
                    .animate('left', 0, 2, 3)
                    
                    .bind("EnterFrame", function () {
                        this.walk();
                    })
                    .onHit("SuperSolid", function(){
                           this.turnAround();       
                    })
                    
                   //Pitys
                Crafty.e("NPC, 2D, DOM, pitys, Collision, SpriteAnimation")
                    .attr({x: 400, y: 530, z:100, dX:1})
                    .animate('sit', 0, 2, 3)
                    
                    .bind("EnterFrame", function () {
                        this.animate('sit', 3);
                    })

                   //Judy
                Crafty.e("NPC, 2D, DOM, judy, Collision, SpriteAnimation")
                    .attr({x: 700, y: 530, z:100, dX:1})
                    .animate('stand', 0, 0, 3)
                    
                    .bind("EnterFrame", function () {
                        this.animate('stand', 3);
                    })
                 
                /*End Reset
                Crafty.e("reseter, 2D, DOM, Text")
                    .attr({x: 190, y: 600, w:400, h:40,  z:10000000000})
                    .text("")
                    .bind("EnterFrame", function () {
                        if (over){
                            this.textFont({ family: 'Arial', size:"20px" })
                            this.text("Continue building");
                            }
                    })
                    .bind("Click", function () {
                        if (over){
                              Crafty("Post").each(function ()  {
                                this.visible = false;
                            })
                        }
    
                    })*/
                    
                    
                    
                //Meters    
                Crafty.e("Dolly_Meter_back, 2D, DOM, Color")
                    .attr({x: 100, y: 725, w:100, h:20, z:100})
                    .color("lightgray")
            
                        
                Crafty.e("Dolly_Meter_front, 2D, DOM, Color")
                    .attr({x: 100, y: 725, w:0, h:20, z:100})
                    .color("green")
                    .bind("EnterFrame", function () {
                        if (d<=100)
                            this.w = d;
                    })
                 Crafty.e("Pitys_Meter_back, 2D, DOM, Color")
                    .attr({x: 300, y: 725, w:100, h:20, z:100})
                    .color("lightgray")
            
                        
                Crafty.e("Pitys_Meter_front, 2D, DOM, Color")
                    .attr({x: 300, y: 725, w:0, h:20, z:100})
                    .color("green")
                    .bind("EnterFrame", function () {
                        if (pt<=100)
                            this.w = pt;
                    })
                Crafty.e("Judy_Meter_back, 2D, DOM, Color")
                    .attr({x: 500, y: 725, w:100, h:20, z:100})
                    .color("lightgray")
            
                        
                Crafty.e("Judy_Meter_front, 2D, DOM, Color")
                    .attr({x: 500, y: 725, w:0, h:20, z:100})
                    .color("green")
                    .bind("EnterFrame", function () {
                        if (ju<=100)
                            this.w = ju;
                    })
                Crafty.e("Anna_Meter_back, 2D, DOM, Color")
                    .attr({x: 700, y: 725, w:100, h:20, z:100})
                    .color("lightgray")
            
                        
                Crafty.e("Anna_Meter_front, 2D, DOM, Color")
                    .attr({x: 700, y: 725, w:0, h:20, z:100})
                    .color("green")
                    .bind("EnterFrame", function () {
                        if (a<=100)
                            this.w = a;
                    })                    
                    
                    
                    
                    
                //Brush
                Crafty.e("Brush, 2D, DOM, Color, Multiway")
                    .color(color)
                    .attr({ x: 200, y: 210, w: 20, h: 20, z:100000})
                    //.multiway(10, { UP_ARROW: -90, DOWN_ARROW: 90, LEFT_ARROW: 180, RIGHT_ARROW: 0 })
                    
                    .bind('EnterFrame', function () {
                       // hit floor or roof
                        if (this.y <= 20 )
                            this.y = 20;
                        if (this.y >= 860 )
                            this.y = 860;
                            
                                     
                
                        if (unreadPost){
                            pst = document.getElementById('PostBox').value;
                            Crafty("PlayerPost").text("    " + pst); 
                            unreadPost = false;
                                    p += 100;
                            
                        }
                    })                     

                    .bind("KeyDown", function (e) {
                        
                        if(!over){
                            if (e.key == Crafty.keys['ENTER'] ){    
                                if (media == 0){ 
                                    if (p >= 10){
                                        Crafty.e('2D, DOM, brick, Collision, Gravity, Solid, SuperSolid')
                                            //.color("blue")
                                            .attr({
                                            w: 20,
                                            h: 20,
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p -= 10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                    }
                                } else if (media == 1){
                                    if (p >= 10){
                                        Crafty.e('2D, DOM,  window, SpriteAnimation, Collision, Gravity, Solid')
                                            .attr({
                                                w: 20,
                                                h: 20,
                                                x: this.x,
                                                y: this.y
                                            })
                                            .collision()
                                            .animate('window', 0, 1, 1)
                                            .bind("EnterFrame", function () {
                                                if(!this.isPlaying())
                                                    this.animate('window', 800);
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                    }                              
                                } else if(media == 2){
                                    if (p >= 50){
                                        Crafty.e("2D, DOM, cat, SpriteAnimation, Gravity, Collision, Mover")
                                            .attr({
                                            x: this.x,
                                            y: this.y,
                                            z: 100000,
                                            dX: 1,
                                            speed:5,
                                            turnFactor:1
                                            })

                                            .animate('right', 0, 0, 2)
                                            .animate('left', 0, 1, 2)
                                            
                                            .bind("EnterFrame", function () {
                                                this.walk();
                                            })
                                            .onHit("SuperSolid", function(){
                                                   this.turnAround();       
                                            })
                                            .gravity("SuperSolid")
                                        p -= 50;
                                        a += 5;                                    
                                    }
                                } else if(media == 3){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, roof1, Gravity, Solid, SuperSolid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p -= 10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                     }
                                } else if(media == 4){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, roof3, Gravity, Solid, SuperSolid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                    }    
                                } else if(media == 5){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, roof2, Gravity, Solid, SuperSolid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                    }
                                }else if(media == 6){
                                    if (p >= 20){
                                        Crafty.e("2D, DOM, door, Gravity, Solid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=20;
                                        if(this.x < 313 )
                                            d +=2;
                                        else if (this.x < 626){
                                            pt +=2;
                                        }else{
                                            ju +=2;
                                        }
                                    }
                                }else if(media == 7){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, inbrick, Gravity, Solid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }                                    
                                    }
                                }else if(media == 8){
                                    if (p >= 20){
                                        Crafty.e("2D, DOM, indoor, Gravity, Solid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=20;
                                        if(this.x < 313 )
                                            d +=2;
                                        else if (this.x < 626){
                                            pt +=2;
                                        }else{
                                            ju +=2;
                                        }
                                    }
                                }else if(media == 9){
                                    if (p >= 20){
                                        Crafty.e("2D, DOM, tree1, Gravity, Solid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=20;
                                        if(this.x < 313 )
                                            d +=2;
                                        else if (this.x < 626){
                                            pt +=3;
                                        }else{
                                            ju +=2;
                                        }
                                    }
                                }else if(media == 10){
                                    if (p >= 20){
                                        Crafty.e("2D, DOM, tree2, Gravity, Solid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=20;
                                        if(this.x < 313 )
                                            d +=2;
                                        else if (this.x < 626){
                                            pt +=3;
                                        }else{
                                            ju +=2;
                                        }
                                    }
                                }else if(media == 11){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, b_roof1, Gravity, Solid, SuperSolid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }                                    
                                    }
                                } else if(media == 12){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, b_roof3, Gravity, Solid, SuperSolid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                    }
                                } else if(media == 13){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, b_roof2, Gravity, Solid, SuperSolid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                    }
                                } else if(media == 14){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, b_fence, Gravity, Solid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=2;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                    }
                                } else if(media == 15){
                                    if (p >= 10){
                                        Crafty.e("2D, DOM, w_fence, Gravity, Solid")
                                            .attr({
                                            x: this.x,
                                            y: this.y
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=2;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=1;
                                        }
                                    }
                                } else if (media == 16){
                                    if (p >= 10){
                                        Crafty.e('2D, DOM,  flower, SpriteAnimation, Collision, Gravity, Solid')
                                            .attr({
                                                w: 20,
                                                h: 20,
                                                x: this.x,
                                                y: this.y
                                            })
                                            .collision()
                                            .animate('wave', 0, 0, 1)
                                            .bind("EnterFrame", function () {
                                                if(!this.isPlaying())
                                                    this.animate('wave', 800);
                                            })
                                            .gravity("Solid")
                                        p-=10;
                                        if(this.x < 313 )
                                            d +=1;
                                        else if (this.x < 626){
                                            pt +=1;
                                        }else{
                                            ju +=2;
                                        }
                                    }       

                            }        
                            } else if (e.key == Crafty.keys['UP_ARROW'] ){
                                    this.y = this.y - 20;
                            }else if (e.key == Crafty.keys['DOWN_ARROW'] ){
                                    this.y = this.y + 20;
                            }else if (e.key == Crafty.keys['LEFT_ARROW'] ){
                                    this.x = this.x - 20;
                            }else if (e.key == Crafty.keys['RIGHT_ARROW'] ){
                                    this.x = this.x + 20;
                            }
                    
                        }
                    })
                 
                        

            })
            
            function newPost(){
                unreadPost = true;
            }
            
             //Message 
            Crafty.e("Message, DOM")
                .bind("EnterFrame", function () {
                    if (unreadPost){                     
                        p = p + 100;
                   }
                   
                   document.getElementById('pointbox').value =  p;
                   if(p <=0){
                        document.getElementById('pointbox').style.color = "red";
                   }else{
                        document.getElementById('pointbox').style.color = "black";
                   }
                   //document.getElementById('annameter').value =  a; Replaced by ingame progress bars
                   //document.getElementById('dollymeter').value =  d;
                   //document.getElementById('pitysmeter').value =  pt;
                  // document.getElementById('judymeter').value =  ju;
                })
            

        
</script>
        </div>
    </div>
    <!-- <div id="Meters" class="grid_8 push_2"> -->
    <div id="Meters" class="grid_12" style="text-align: center;"push_2>
        <a href="https://github.com/Prgnization/game-off-2012/blob/master/README.md">How to Play</a>
        <p>Post New Message: <input  id = "PostBox" name="post" value="   Hello!" autofocus="autofocus"><input type="button" value="Post!" onClick=newPost();> Current Points <input  id = "pointbox" name="pointbox" readonly="readonly" ></p>
       <!-- <p>Friendship Meters:</p> 
        <p>Dolly: <input  id = "dollymeter" readonly="readonly" > Pitys: <input  id = "pitysmeter" readonly="readonly" ></p><p>Judy:  <input  id = "judymeter" readonly="readonly" > Anna: <input  id = "annameter" readonly="readonly" > </p>-->
        
    </div>
 </div>
</body>
</html>
